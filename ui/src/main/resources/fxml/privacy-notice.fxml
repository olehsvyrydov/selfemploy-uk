<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.Insets?>

<!--
    SE-507: Privacy Notice UI
    Full-screen modal dialog for privacy notice acknowledgment.
    Design specification: /aura
    Legal content: /alex (Version 1.0)
-->
<!-- Stylesheets loaded programmatically to avoid JPMS issues -->
<VBox xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="uk.selfemploy.ui.controller.PrivacyNoticeController"
      styleClass="privacy-notice-container" prefWidth="600" maxHeight="700">

    <!-- Header -->
    <HBox styleClass="dialog-header" alignment="CENTER_LEFT">
        <padding><Insets top="20" right="24" bottom="20" left="24"/></padding>
        <Label text="Privacy Notice" styleClass="dialog-title"/>
        <Region HBox.hgrow="ALWAYS"/>
        <Button fx:id="closeBtn" text="X" styleClass="close-button"
                onAction="#handleClose" visible="false" managed="false"/>
    </HBox>

    <!-- Content -->
    <VBox styleClass="dialog-content" spacing="20" VBox.vgrow="ALWAYS">
        <padding><Insets top="0" right="24" bottom="24" left="24"/></padding>

        <!-- Privacy Header -->
        <VBox styleClass="privacy-header" alignment="CENTER" spacing="12">
            <Label text="ðŸ›¡" styleClass="privacy-icon"/>
            <Label text="Your Privacy Matters" styleClass="privacy-title"/>
            <HBox alignment="CENTER" spacing="8">
                <Label fx:id="versionLabel" text="Version 1.0" styleClass="privacy-version"/>
                <Label text="|" styleClass="privacy-separator"/>
                <Label fx:id="effectiveDateLabel" text="Effective: 1 January 2026"
                       styleClass="privacy-effective-date"/>
            </HBox>
        </VBox>

        <!-- Scrollable Privacy Content -->
        <ScrollPane fx:id="contentScroll" styleClass="privacy-content-scroll"
                    fitToWidth="true" hbarPolicy="NEVER" VBox.vgrow="ALWAYS">
            <VBox fx:id="privacyContent" styleClass="privacy-content" spacing="16">
                <padding><Insets top="16" right="16" bottom="16" left="16"/></padding>

                <!-- Section 1: Who We Are -->
                <VBox styleClass="privacy-section" spacing="8">
                    <Label text="1. Who We Are" styleClass="privacy-section-title"/>
                    <Label styleClass="privacy-section-text" wrapText="true"
                           text="This application is developed and maintained as open-source software under the Apache License 2.0. This privacy notice explains how your data is handled when you use UK Self-Employment Manager."/>
                    <Label styleClass="privacy-section-text privacy-important" wrapText="true"
                           text="Important: Because all your data is stored locally on your device, YOU are the data controller for your own information. We (the software developers) do not have access to your data."/>
                </VBox>

                <!-- Section 2: Data We Process -->
                <VBox styleClass="privacy-section" spacing="8">
                    <Label text="2. Data We Process" styleClass="privacy-section-title"/>

                    <!-- 2.1 Financial and Tax Data -->
                    <Label text="2.1 Financial and Tax Data (Stored Locally)" styleClass="privacy-subsection-title"/>
                    <VBox styleClass="privacy-list" spacing="4">
                        <Label text="- Income records: Dates, amounts, descriptions, sources"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Expense records: Dates, amounts, categories, descriptions"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Bank transactions: Imported CSV data from your bank statements"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Tax calculations: Computed tax liabilities based on your data"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Receipt attachments: Images or PDFs you attach to transactions"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Unique Taxpayer Reference (UTR): Your HMRC identifier"
                               styleClass="privacy-list-item" wrapText="true"/>
                    </VBox>
                    <Label styleClass="privacy-section-text privacy-storage" wrapText="true"
                           text="Where stored: Encrypted database on your local device only"/>
                    <Label styleClass="privacy-section-text privacy-retention" wrapText="true"
                           text="Retention: You control retention; HMRC requires 5 years"/>

                    <!-- 2.2 HMRC Connection Data -->
                    <Label text="2.2 HMRC Connection Data (When You Connect)" styleClass="privacy-subsection-title"/>
                    <Label styleClass="privacy-section-text" wrapText="true"
                           text="When you connect to HMRC for Making Tax Digital submissions, the following data is collected and transmitted:"/>
                    <VBox styleClass="privacy-list" spacing="4">
                        <Label text="- Device information: Unique device ID (UUID), operating system, screen configuration"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Network information: Local IP addresses, MAC addresses, timezone"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- User information: Operating system username"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Authentication tokens: Access and refresh tokens for HMRC API"
                               styleClass="privacy-list-item" wrapText="true"/>
                    </VBox>
                    <Label styleClass="privacy-section-text privacy-important" wrapText="true"
                           text="Why: This is legally required by HMRC under the Finance Act 2022 and Transaction Monitoring Regulations. We cannot submit your tax returns without this data."/>
                </VBox>

                <!-- Section 3: How We Use Your Data -->
                <VBox styleClass="privacy-section" spacing="8">
                    <Label text="3. How We Use Your Data" styleClass="privacy-section-title"/>
                    <VBox styleClass="privacy-list" spacing="4">
                        <Label text="- Calculate your tax liability (Legal basis: Contract performance)"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Submit returns to HMRC (Legal basis: Contract performance)"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Comply with HMRC fraud prevention (Legal basis: Legal obligation)"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Store HMRC access tokens (Legal basis: Legitimate interests)"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Maintain audit trail (Legal basis: Legitimate interests)"
                               styleClass="privacy-list-item" wrapText="true"/>
                    </VBox>
                </VBox>

                <!-- Section 4: Data Storage and Security -->
                <VBox styleClass="privacy-section" spacing="8">
                    <Label text="4. Data Storage and Security" styleClass="privacy-section-title"/>
                    <Label styleClass="privacy-section-text privacy-important" wrapText="true"
                           text="All your financial data is stored ONLY on your device."/>
                    <Label styleClass="privacy-section-text" wrapText="true"
                           text="We implement the following security measures:"/>
                    <VBox styleClass="privacy-list" spacing="4">
                        <Label text="- AES-256-GCM encryption for the local database"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Operating system credential storage for authentication tokens"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- TLS 1.2+ encryption for all communications with HMRC"
                               styleClass="privacy-list-item" wrapText="true"/>
                    </VBox>
                    <Label styleClass="privacy-section-text" wrapText="true"
                           text="We do NOT: Store your data on any remote servers, have access to your financial information, share your data with third parties (except HMRC when you initiate a submission), or use your data for analytics, advertising, or any other purpose."/>
                </VBox>

                <!-- Section 5: Data Retention -->
                <VBox styleClass="privacy-section" spacing="8">
                    <Label text="5. Data Retention" styleClass="privacy-section-title"/>
                    <VBox styleClass="privacy-list" spacing="4">
                        <Label text="- Financial records: You decide (HMRC requires 5 years minimum)"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- HMRC tokens: Until you disconnect"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Acknowledgment records: Indefinite (audit trail)"
                               styleClass="privacy-list-item" wrapText="true"/>
                    </VBox>
                    <Label styleClass="privacy-section-text privacy-important" wrapText="true"
                           text="Your responsibility: HMRC requires you to keep records for at least 5 years from the 31 January following the tax year. This application helps you meet this requirement, but the legal responsibility remains yours."/>
                </VBox>

                <!-- Section 6: Your Rights -->
                <VBox styleClass="privacy-section" spacing="8">
                    <Label text="6. Your Rights Under UK GDPR" styleClass="privacy-section-title"/>
                    <VBox styleClass="privacy-list" spacing="4">
                        <Label text="- Access: Request a copy of your data (Export feature in Settings)"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Rectification: Correct inaccurate data (Edit records in the application)"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Erasure: Delete your data (Delete records or uninstall application)"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Restriction: Limit how data is processed (Contact us)"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Portability: Receive data in portable format (Export to JSON/CSV)"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Object: Object to processing (Contact us)"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Complain: Lodge complaint with ICO (ico.org.uk)"
                               styleClass="privacy-list-item" wrapText="true"/>
                    </VBox>
                    <Label styleClass="privacy-section-text" wrapText="true"
                           text="Note: Because your data is stored locally on your device, you already have full control. You can view, edit, export, or delete any data at any time."/>
                </VBox>

                <!-- Section 7: HMRC Fraud Prevention -->
                <VBox styleClass="privacy-section" spacing="8">
                    <Label text="7. HMRC Fraud Prevention" styleClass="privacy-section-title"/>
                    <Label styleClass="privacy-section-text" wrapText="true"
                           text="When you connect to HMRC, certain device information is collected and transmitted as required by law. This includes device identifiers (UUID), operating system information, network information (local IP, MAC addresses), and timezone and screen configuration."/>
                    <Label styleClass="privacy-section-text privacy-important" wrapText="true"
                           text="This is not optional. HMRC will reject submissions without this information."/>
                </VBox>

                <!-- Section 8: Changes to This Notice -->
                <VBox styleClass="privacy-section" spacing="8">
                    <Label text="8. Changes to This Notice" styleClass="privacy-section-title"/>
                    <Label styleClass="privacy-section-text" wrapText="true"
                           text="We may update this privacy notice to reflect changes in the application or legal requirements. If we make material changes, the privacy notice version number will change, you will be asked to acknowledge the updated notice, and a summary of changes will be provided."/>
                </VBox>

                <!-- Section 9: Contact -->
                <VBox styleClass="privacy-section" spacing="8">
                    <Label text="9. Contact" styleClass="privacy-section-title"/>
                    <Label styleClass="privacy-section-text" wrapText="true"
                           text="For privacy-related questions, please visit GitHub Issues. To complain about data protection, contact the Information Commissioner's Office (ICO) at ico.org.uk or call the ICO Helpline at 0303 123 1113."/>
                </VBox>

                <!-- Legal Basis Summary -->
                <VBox styleClass="privacy-section privacy-summary" spacing="8">
                    <Label text="Legal Basis Summary" styleClass="privacy-section-title"/>
                    <VBox styleClass="privacy-list" spacing="4">
                        <Label text="- Core functionality: Contract performance (Article 6(1)(b))"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- HMRC fraud prevention: Legal obligation (Article 6(1)(c))"
                               styleClass="privacy-list-item" wrapText="true"/>
                        <Label text="- Token storage: Legitimate interests (Article 6(1)(f))"
                               styleClass="privacy-list-item" wrapText="true"/>
                    </VBox>
                    <Label styleClass="privacy-section-text privacy-compliance" wrapText="true"
                           text="This privacy notice complies with UK GDPR Articles 13 and 14."/>
                </VBox>

                <!-- Full Privacy Policy Link -->
                <HBox alignment="CENTER" styleClass="privacy-link-container">
                    <Hyperlink fx:id="fullPolicyLink" text="Read Full Privacy Policy"
                               styleClass="privacy-full-link" onAction="#handleOpenFullPolicy"/>
                </HBox>
            </VBox>
        </ScrollPane>

        <!-- Acknowledgment Checkbox -->
        <HBox styleClass="acknowledgment-row" alignment="CENTER_LEFT" spacing="12">
            <CheckBox fx:id="acknowledgeCheckbox" onAction="#handleAcknowledgeChange"/>
            <Label text="I have read and understand this privacy notice"
                   styleClass="acknowledgment-label" wrapText="true"/>
        </HBox>
    </VBox>

    <!-- Footer -->
    <HBox styleClass="dialog-footer" alignment="CENTER">
        <padding><Insets top="16" right="24" bottom="24" left="24"/></padding>
        <Button fx:id="continueBtn" text="Continue" styleClass="button-primary"
                onAction="#handleContinue" disable="true" prefWidth="200"/>
    </HBox>
</VBox>
