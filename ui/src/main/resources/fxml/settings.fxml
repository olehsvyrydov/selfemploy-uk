<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.Insets?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<!--
    Settings Page - User preferences and configuration
    Provides access to:
    - Profile settings (UTR)
    - Legal documents (Terms, Privacy)
    - Data management (Export/Import)
    - Application info
-->
<ScrollPane xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="uk.selfemploy.ui.controller.SettingsController"
            styleClass="settings-scroll" fitToWidth="true" hbarPolicy="NEVER">

    <VBox styleClass="settings-container" spacing="24">
        <padding><Insets top="30" right="30" bottom="30" left="30"/></padding>

        <!-- Page Header -->
        <VBox spacing="8">
            <Label text="Settings" styleClass="page-title"/>
            <Label text="Configure your preferences and manage your data" styleClass="page-subtitle"/>
        </VBox>

        <!-- Profile Section -->
        <VBox styleClass="settings-section, settings-section-profile" spacing="16">
            <Label text="Profile" styleClass="section-title"/>

            <!-- Display Name Setting (optional, personalization) -->
            <VBox styleClass="settings-card, settings-card-profile" spacing="12">
                <HBox alignment="CENTER_LEFT" spacing="12">
                    <FontIcon iconLiteral="fas-user" iconSize="20" styleClass="settings-icon"/>
                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                        <Label text="Display Name" styleClass="settings-label"/>
                        <Label fx:id="displayNameLabel" text="Not set" styleClass="settings-value"/>
                    </VBox>
                </HBox>
                <HBox spacing="8" alignment="CENTER_LEFT">
                    <TextField fx:id="displayNameField"
                               promptText="e.g., Sarah, John Smith, or just your first name"
                               styleClass="utr-field" HBox.hgrow="ALWAYS"
                               accessibleText="Enter your preferred display name"/>
                    <Button fx:id="saveDisplayNameButton" text="Save" styleClass="button-secondary" onAction="#handleSaveDisplayName"/>
                </HBox>
                <Label text="Optional. How would you like to be addressed? This appears on your dashboard greeting and PDF reports."
                       styleClass="settings-hint" wrapText="true"/>
            </VBox>

            <!-- UTR Setting -->
            <VBox styleClass="settings-card, settings-card-profile" spacing="12">
                <HBox alignment="CENTER_LEFT" spacing="12">
                    <FontIcon iconLiteral="fas-clipboard" iconSize="20" styleClass="settings-icon"/>
                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                        <Label text="Unique Taxpayer Reference (UTR)" styleClass="settings-label"/>
                        <Label fx:id="utrLabel" text="Not set" styleClass="settings-value"/>
                    </VBox>
                </HBox>
                <HBox spacing="8" alignment="CENTER_LEFT">
                    <TextField fx:id="utrField" promptText="Enter 10-digit UTR"
                               styleClass="utr-field" HBox.hgrow="ALWAYS"
                               accessibleText="Enter your 10-digit Unique Taxpayer Reference"/>
                    <Button fx:id="saveUtrButton" text="Save" styleClass="button-secondary" onAction="#handleSaveUtr"/>
                </HBox>
                <Label text="Optional. Your UTR may be required for future annual Self Assessment submissions. Currently, MTD quarterly updates use NINO instead. Find your UTR on Self Assessment notices or your HMRC online account."
                       styleClass="settings-hint" wrapText="true"/>
            </VBox>

            <!-- NINO Setting -->
            <VBox styleClass="settings-card, settings-card-profile" spacing="12">
                <HBox alignment="CENTER_LEFT" spacing="12">
                    <FontIcon iconLiteral="fas-id-card" iconSize="20" styleClass="settings-icon"/>
                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                        <Label text="National Insurance Number (NINO)" styleClass="settings-label"/>
                        <Label fx:id="ninoLabel" text="Not set" styleClass="settings-value"/>
                    </VBox>
                </HBox>
                <HBox spacing="8" alignment="CENTER_LEFT">
                    <TextField fx:id="ninoField" promptText="e.g. QQ 12 34 56 A"
                               styleClass="utr-field" HBox.hgrow="ALWAYS"
                               accessibleText="Enter your National Insurance Number"/>
                    <Button fx:id="saveNinoButton" text="Save" styleClass="button-secondary" onAction="#handleSaveNino"/>
                </HBox>
                <Label text="Required. Your NINO is essential for all MTD submissions to HMRC. Find it on payslips, P60, tax letters, or the HMRC app."
                       styleClass="settings-hint" wrapText="true"/>
            </VBox>
        </VBox>

        <!-- HMRC Connection Setup Section -->
        <VBox styleClass="settings-section, settings-section-hmrc" spacing="16">
            <Label text="HMRC Connection Setup" styleClass="section-title"/>

            <VBox styleClass="settings-card, settings-card-hmrc" spacing="12">
                <!-- Status Display -->
                <HBox alignment="CENTER_LEFT" spacing="12">
                    <FontIcon fx:id="hmrcStatusIcon" iconLiteral="fas-link" iconSize="20" styleClass="settings-icon"/>
                    <VBox spacing="4" HBox.hgrow="ALWAYS">
                        <Label text="Connection Status" styleClass="settings-label"/>
                        <Label fx:id="hmrcConnectionStatusLabel" text="Not set up" styleClass="settings-value"/>
                    </VBox>
                </HBox>

                <!-- Setup Instructions -->
                <Label fx:id="hmrcSetupInstructions"
                       text="Set up your HMRC connection to enable MTD submissions. This is a one-time setup that verifies your NINO and connects to your HMRC account."
                       styleClass="settings-hint" wrapText="true"/>

                <!-- Action Buttons -->
                <HBox spacing="8" alignment="CENTER_LEFT">
                    <Button fx:id="hmrcSetupButton" text="Connect &amp; Verify" styleClass="button-primary" onAction="#handleHmrcSetup"/>
                    <Button fx:id="hmrcDisconnectButton" text="Disconnect" styleClass="button-secondary" onAction="#handleHmrcDisconnect" visible="false" managed="false"/>
                </HBox>

                <!-- Setup Checklist (shows progress) -->
                <VBox fx:id="hmrcSetupChecklist" spacing="4" visible="false" managed="false">
                    <HBox alignment="CENTER_LEFT" spacing="8">
                        <FontIcon fx:id="checkNino" iconLiteral="fas-circle" iconSize="12"/>
                        <Label text="NINO saved" styleClass="settings-hint"/>
                    </HBox>
                    <HBox alignment="CENTER_LEFT" spacing="8">
                        <FontIcon fx:id="checkOAuth" iconLiteral="fas-circle" iconSize="12"/>
                        <Label text="HMRC connected" styleClass="settings-hint"/>
                    </HBox>
                    <HBox alignment="CENTER_LEFT" spacing="8">
                        <FontIcon fx:id="checkProfile" iconLiteral="fas-circle" iconSize="12"/>
                        <Label text="Business profile synced" styleClass="settings-hint"/>
                    </HBox>
                </VBox>
            </VBox>
        </VBox>

        <!-- Legal Section -->
        <VBox styleClass="settings-section, settings-section-legal" spacing="16">
            <Label text="Legal" styleClass="section-title"/>

            <!-- Terms of Service -->
            <HBox styleClass="settings-card-row, settings-card-legal" alignment="CENTER_LEFT" spacing="12">
                <FontIcon iconLiteral="fas-file-alt" iconSize="20" styleClass="settings-icon"/>
                <VBox spacing="4" HBox.hgrow="ALWAYS">
                    <Label text="Terms of Service" styleClass="settings-label"/>
                    <Label text="View the application terms and conditions" styleClass="settings-description"/>
                </VBox>
                <Button fx:id="termsButton" text="View" styleClass="button-secondary" onAction="#handleShowTerms"/>
            </HBox>

            <!-- Privacy Notice -->
            <HBox styleClass="settings-card-row, settings-card-legal" alignment="CENTER_LEFT" spacing="12">
                <FontIcon iconLiteral="fas-shield-alt" iconSize="20" styleClass="settings-icon"/>
                <VBox spacing="4" HBox.hgrow="ALWAYS">
                    <Label text="Privacy Notice" styleClass="settings-label"/>
                    <Label text="View how your data is handled" styleClass="settings-description"/>
                </VBox>
                <Button fx:id="privacyButton" text="View" styleClass="button-secondary" onAction="#handleShowPrivacy"/>
            </HBox>
        </VBox>

        <!-- Data Management Section -->
        <VBox styleClass="settings-section, settings-section-data" spacing="16">
            <Label text="Data Management" styleClass="section-title"/>

            <!-- Export Data -->
            <HBox styleClass="settings-card-row, settings-card-data" alignment="CENTER_LEFT" spacing="12">
                <FontIcon iconLiteral="fas-upload" iconSize="20" styleClass="settings-icon"/>
                <VBox spacing="4" HBox.hgrow="ALWAYS">
                    <Label text="Export Data" styleClass="settings-label"/>
                    <Label text="Export your income, expenses, and tax data to a file" styleClass="settings-description"/>
                </VBox>
                <Button fx:id="exportButton" text="Export" styleClass="button-secondary" onAction="#handleExportData"/>
            </HBox>

            <!-- Import Data -->
            <HBox styleClass="settings-card-row, settings-card-data" alignment="CENTER_LEFT" spacing="12">
                <FontIcon iconLiteral="fas-download" iconSize="20" styleClass="settings-icon"/>
                <VBox spacing="4" HBox.hgrow="ALWAYS">
                    <Label text="Import Data" styleClass="settings-label"/>
                    <Label text="Import data from a previously exported file" styleClass="settings-description"/>
                </VBox>
                <Button fx:id="importButton" text="Import" styleClass="button-secondary" onAction="#handleImportData"/>
            </HBox>
        </VBox>

        <!-- Footer Disclaimer -->
        <VBox styleClass="settings-disclaimer" spacing="8">
            <HBox alignment="CENTER_LEFT" spacing="8">
                <FontIcon iconLiteral="fas-exclamation-triangle" iconSize="16" styleClass="disclaimer-icon"/>
                <Label text="Important" styleClass="disclaimer-title"/>
            </HBox>
            <Label text="This application provides tax estimates only. Always verify calculations with a qualified accountant before submitting to HMRC. You are responsible for the accuracy of your tax returns."
                   styleClass="disclaimer-text" wrapText="true"/>
        </VBox>

    </VBox>
</ScrollPane>
