<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.Cursor?>
<?import javafx.geometry.Insets?>

<ScrollPane xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="uk.selfemploy.ui.controller.DashboardController"
            styleClass="dashboard-scroll"
            fitToWidth="true" hbarPolicy="NEVER">

    <VBox fx:id="dashboardContainer" styleClass="dashboard-container" spacing="24">
        <padding><Insets top="30" right="30" bottom="30" left="30"/></padding>

        <!-- Page Header with Personalized Greeting -->
        <VBox spacing="4">
            <Label fx:id="greetingLabel" text="Good morning!" styleClass="dashboard-greeting"/>
            <HBox alignment="CENTER_LEFT" spacing="15">
                <Label text="Dashboard" styleClass="page-title"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label fx:id="taxYearBadge" text="Tax Year 2025/26" styleClass="tax-year-badge"/>
            </HBox>
        </VBox>

        <!-- Metric Cards Grid - SE-810: Keyboard accessible cards -->
        <GridPane fx:id="metricsGrid" styleClass="metrics-grid" hgap="20" vgap="20">
            <columnConstraints>
                <ColumnConstraints percentWidth="25"/>
                <ColumnConstraints percentWidth="25"/>
                <ColumnConstraints percentWidth="25"/>
                <ColumnConstraints percentWidth="25"/>
            </columnConstraints>

            <!-- Income Card - SE-810: Focusable with keyboard navigation -->
            <VBox fx:id="incomeCard" styleClass="metric-card, metric-income" GridPane.columnIndex="0"
                  focusTraversable="true" onKeyPressed="#handleIncomeCardKeyPress"
                  onMouseClicked="#handleIncomeCardClick">
                <cursor><Cursor fx:constant="HAND"/></cursor>
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <Label text="+" styleClass="metric-icon, icon-income"/>
                    <Label text="TOTAL INCOME" styleClass="metric-label"/>
                </HBox>
                <Region VBox.vgrow="ALWAYS"/>
                <Label fx:id="incomeValue" text="£0.00" styleClass="metric-value"/>
                <Label fx:id="incomeTrend" text="£0.00 this month" styleClass="metric-trend, trend-positive"/>
            </VBox>

            <!-- Expenses Card - SE-810: Focusable with keyboard navigation -->
            <VBox fx:id="expensesCard" styleClass="metric-card, metric-expenses" GridPane.columnIndex="1"
                  focusTraversable="true" onKeyPressed="#handleExpensesCardKeyPress"
                  onMouseClicked="#handleExpensesCardClick">
                <cursor><Cursor fx:constant="HAND"/></cursor>
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <Label text="-" styleClass="metric-icon, icon-expenses"/>
                    <Label text="TOTAL EXPENSES" styleClass="metric-label"/>
                </HBox>
                <Region VBox.vgrow="ALWAYS"/>
                <Label fx:id="expensesValue" text="£0.00" styleClass="metric-value"/>
                <Label fx:id="expensesTrend" text="£0.00 this month" styleClass="metric-trend, trend-neutral"/>
            </VBox>

            <!-- Net Profit Card - SE-810: Focusable with keyboard navigation -->
            <VBox fx:id="profitCard" styleClass="metric-card, metric-profit" GridPane.columnIndex="2"
                  focusTraversable="true" onKeyPressed="#handleProfitCardKeyPress"
                  onMouseClicked="#handleProfitCardClick">
                <cursor><Cursor fx:constant="HAND"/></cursor>
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <Label text="=" styleClass="metric-icon, icon-profit"/>
                    <Label text="NET PROFIT" styleClass="metric-label"/>
                </HBox>
                <Region VBox.vgrow="ALWAYS"/>
                <Label fx:id="profitValue" text="£0.00" styleClass="metric-value"/>
                <Label text="Taxable amount" styleClass="metric-trend"/>
            </VBox>

            <!-- Estimated Tax Card - SE-810: Focusable with keyboard navigation -->
            <VBox fx:id="taxCard" styleClass="metric-card, metric-tax" GridPane.columnIndex="3"
                  focusTraversable="true" onKeyPressed="#handleTaxCardKeyPress"
                  onMouseClicked="#handleTaxCardClick">
                <cursor><Cursor fx:constant="HAND"/></cursor>
                <HBox alignment="CENTER_LEFT" spacing="8">
                    <Label text="£" styleClass="metric-icon, icon-tax"/>
                    <Label text="ESTIMATED TAX" styleClass="metric-label"/>
                </HBox>
                <Region VBox.vgrow="ALWAYS"/>
                <Label fx:id="taxValue" text="£0.00" styleClass="metric-value"/>
                <Label text="Income Tax + NI" styleClass="metric-trend"/>
            </VBox>
        </GridPane>

        <!-- Tax Year Progress -->
        <VBox styleClass="card" spacing="15">
            <Label text="Tax Year Progress" styleClass="card-title"/>
            <ProgressBar fx:id="yearProgress" progress="0.0" maxWidth="Infinity" styleClass="year-progress"/>
            <HBox alignment="CENTER" spacing="20">
                <Label fx:id="yearStart" text="Started: 6 Apr 2025" styleClass="label-secondary"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label fx:id="daysRemaining" text="365 days remaining" styleClass="label-secondary, text-primary"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label fx:id="yearEnd" text="Ends: 5 Apr 2026" styleClass="label-secondary"/>
            </HBox>
        </VBox>

        <!-- Quick Actions & Deadlines Row -->
        <HBox spacing="20">
            <!-- Quick Actions -->
            <VBox styleClass="card" spacing="12" HBox.hgrow="ALWAYS">
                <Label text="Quick Actions" styleClass="card-title"/>
                <Button fx:id="addIncomeBtn" text="+ Add Income" styleClass="action-button, action-income"
                        maxWidth="Infinity" onAction="#handleAddIncome"/>
                <Button fx:id="addExpenseBtn" text="+ Add Expense" styleClass="action-button, action-expense"
                        maxWidth="Infinity" onAction="#handleAddExpense"/>
                <Button fx:id="viewTaxBtn" text="View Tax Breakdown" styleClass="action-button, action-tax"
                        maxWidth="Infinity" onAction="#handleViewTax"/>
            </VBox>

            <!-- Upcoming Deadlines -->
            <VBox styleClass="card" spacing="12" HBox.hgrow="ALWAYS">
                <Label text="Upcoming Deadlines" styleClass="card-title"/>
                <VBox fx:id="deadlinesList" spacing="8">
                    <!-- Populated dynamically -->
                </VBox>
            </VBox>
        </HBox>

        <!-- Recent Activity -->
        <VBox styleClass="card" spacing="15">
            <HBox alignment="CENTER_LEFT">
                <Label text="Recent Activity" styleClass="card-title"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Hyperlink text="View All" styleClass="link" onAction="#handleViewAllActivity"/>
            </HBox>
            <VBox fx:id="activityList" spacing="8">
                <Label fx:id="emptyActivityLabel" text="No recent activity. Add income or expenses to see them here." styleClass="empty-state"/>
            </VBox>
        </VBox>

    </VBox>
</ScrollPane>
